{#**
 * 2007-2024 PrestaShop
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to http://www.prestashop.com for more information.
 *
 * @author    PrestaShop SA <contact@prestashop.com>
 * @copyright 2007-2025 PrestaShop SA
 * @license   https://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 *}
#}
{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block content %}
<div class="panel">
    <h3><i class="icon icon-eraser"></i> {{ 'Granular Cache Invalidation'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</h3>
    <p>{{ 'Invalidate cache for specific content types or URLs.'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</p>

    <div class="form-group">
        <label class="control-label col-lg-3">{{ 'Invalidate Product Cache'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</label>
        <div class="col-lg-6">
            <input type="number" id="invalidate_product_id" class="form-control" placeholder="{{ 'Product ID'|trans({}, 'Modules.Macymedcacheboost.Admin') }}" />
        </div>
        <div class="col-lg-3">
            <button type="button" id="invalidate_product_btn" class="btn btn-default">{{ 'Invalidate'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</button>
        </div>
        <div class="col-lg-9 col-lg-offset-3">
            <p id="invalidate_product_status" class="help-block"></p>
        </div>
    </div>

    <div class="form-group">
        <label class="control-label col-lg-3">{{ 'Invalidate Category Cache'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</label>
        <div class="col-lg-6">
            <input type="number" id="invalidate_category_id" class="form-control" placeholder="{{ 'Category ID'|trans({}, 'Modules.Macymedcacheboost.Admin') }}" />
        </div>
        <div class="col-lg-3">
            <button type="button" id="invalidate_category_btn" class="btn btn-default">{{ 'Invalidate'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</button>
        </div>
        <div class="col-lg-9 col-lg-offset-3">
            <p id="invalidate_category_status" class="help-block"></p>
        </div>
    </div>

    <div class="form-group">
        <label class="control-label col-lg-3">{{ 'Invalidate CMS Page Cache'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</label>
        <div class="col-lg-6">
            <input type="number" id="invalidate_cms_id" class="form-control" placeholder="{{ 'CMS ID'|trans({}, 'Modules.Macymedcacheboost.Admin') }}" />
        </div>
        <div class="col-lg-3">
            <button type="button" id="invalidate_cms_btn" class="btn btn-default">{{ 'Invalidate'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</button>
        </div>
        <div class="col-lg-9 col-lg-offset-3">
            <p id="invalidate_cms_status" class="help-block"></p>
        </div>
    </div>

    <div class="form-group">
        <label class="control-label col-lg-3">{{ 'Invalidate Specific URL'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</label>
        <div class="col-lg-6">
            <input type="text" id="invalidate_url" class="form-control" placeholder="{{ 'Full URL (e.g., https://yourstore.com/product.html)'|trans({}, 'Modules.Macymedcacheboost.Admin') }}" />
        </div>
        <div class="col-lg-3">
            <button type="button" id="invalidate_url_btn" class="btn btn-default">{{ 'Invalidate'|trans({}, 'Modules.Macymedcacheboost.Admin') }}</button>
        </div>
        <div class="col-lg-9 col-lg-offset-3">
            <p id="invalidate_url_status" class="help-block"></p>
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
<script >
    $(document).ready(function(){
        function setupInvalidationButton(buttonId, inputId, statusId, actionName) {
            $(buttonId).on('click', function() {
                var $btn = $(this);
                var $status = $(statusId);
                var id = $(inputId).val();
                var data = {};
                if (actionName === 'InvalidateUrl') {
                    data.url = id;
                } else {
                    data['id_' + actionName.replace('Invalidate', '').toLowerCase()] = id;
                }

                $btn.attr('disabled', true);
                $status.text('Processing...').removeClass('text-success text-danger');

                $.ajax({
                    // L'URL AJAX doit être générée via le routeur Symfony
                    url: '{{ ajax_url }}' + '&action=' + actionName,
                    type: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function(data) {
                        if (data.success) {
                            $status.text(data.message).addClass('text-success');
                        } else {
                            $status.text(data.message).addClass('text-danger');
                        }
                    },
                    error: function() {
                        $status.text('An unexpected error occurred.').addClass('text-danger');
                    },
                    complete: function() {
                        $btn.attr('disabled', false);
                    }
                });
            });
        }

        setupInvalidationButton('#invalidate_product_btn', '#invalidate_product_id', '#invalidate_product_status', 'InvalidateProductCache');
        setupInvalidationButton('#invalidate_category_btn', '#invalidate_category_id', '#invalidate_category_status', 'InvalidateCategoryCache');
        setupInvalidationButton('#invalidate_cms_btn', '#invalidate_cms_id', '#invalidate_cms_status', 'InvalidateCmsCache');
        setupInvalidationButton('#invalidate_url_btn', '#invalidate_url', '#invalidate_url_status', 'InvalidateUrl');
    });
</script>
{% endblock %}
